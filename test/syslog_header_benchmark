#!/usr/bin/env escript

%%! -pa ebin

main([])->
  main(["100000"]);
main([Limit])->
  {ok, [Cases]} = file:consult("./test/frames.tests"),
  Count = list_to_integer(Limit),

  {Time, ok} = timer:tc(fun()-> loop(Cases, length(Cases), Count, Count) end),

  io:format("~p iterations in ~ps~n", [Count, Time/1000000]),
  io:format("~p messages/sec~n", [Count/(Time/1000000)]).

loop(_, _, 0, _)->
  ok;
loop(Cases, Length, Count, Limit) ->
  [syslog_header:parse(Case) || Case <- Cases],
  loop(Cases, Length, Count-Length, Limit).
